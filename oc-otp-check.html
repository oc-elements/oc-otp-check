<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../oc-accounts-api/oc-accounts-api.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../paper-card/paper-card.html">


<dom-module id="oc-otp-check">
    <template>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <style is="custom-style">

            :host {
                display: block;
                background: #fff;
                color: #000;
                padding:15px;
            }
            paper-card {
                width: 100%;
                -webkit-border-radius: 6px;
                -moz-border-radius: 6px;
                border-radius: 6px;
            }

            .add-button-row {
                background: #ffffff;
                margin: 15px 0;
            }
            .add-button {
                width: 100%;
                color: #fff;
                background: #2BB673;
            }

        </style>

        <oc-accounts-api id="accountsApi"></oc-accounts-api>
        <paper-card>
            <div class="card-content col-xs-12">
                <h5>Verify Payment</h5>
                <div class="row">
                    <div class="col-xs-12">
                        <p>Please wait for your OTP</p>
                        <paper-input
                                id="otp"
                                always-float-label
                                required label="OTP Number"
                                prevent-invalid-input
                                type="number"
                                allowed-pattern="[0-9]*"
                                pattern="[0-9]*"
                                name="otp"
                                value="{{_otpData.otp}}">
                        </paper-input>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 add-button-row">
                <paper-button id="submit"  class="primary add-button" on-click="_submit" disabled$="{{_loading}}">Submit</paper-button>
            </div>
        </paper-card>
    </template>

    <script>
        /**
         * `oc-otp-check`
         * Element for checking otp
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class OcOtpCheck extends Polymer.Element {
            static get is() {
                return 'oc-otp-check';
            }

            static get properties() {
                return {
                    _otpData: {
                        typo: Object,
                        value: {}
                    },
                    _loading: {
                        type: Boolean,
                        value: false,
                        notify: true
                    }
                };
            };
            
            ready() {
            	super.ready();
				document.querySelector('shop-app').addEventListener('back', (e) => this._onBack());
			}

			_onBack() {
				history.back();
			}

            _submit() {
                if (!this.$.submit.disabled && this.$.otp.validate()) {

                    //disables the button
                    this._loading = true;

                    let otpData = {};
                    otpData.otp = this._otpData.otp;

                    //disables the button
                    this._loading = false;

                    this.dispatchEvent(new CustomEvent('verify-otp', {
                        bubbles: true,
                        composed: true,
                        detail: {"otpData": otpData}
                    }));
                }
            }
        }

        window.customElements.define(OcOtpCheck.is, OcOtpCheck);
    </script>
</dom-module>
